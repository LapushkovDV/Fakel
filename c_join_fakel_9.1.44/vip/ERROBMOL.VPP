
// ╔═════════════════════════════════════════════════════════════════════╗
// ║              Проект Галактика (с) 1995,96,97 TOP SOFT Ltd.          ║
// ║  Версия :     5.80                                                  ║
// ║  Разработал: Лебедев В.В. (VITAS)                                   ║
// ║  Назначение: функции для пакетной печати ошибок объединения МОЛ     ║
// ╚═════════════════════════════════════════════════════════════════════╝

var
  _nMsgFrm  :longint;      // число ошибок(мессаг)
  _Table  : string[15];    // Модифицируемая таблица
  _nRec   : comp;          // Модифицируемая запись

Function GetMarkerMy(Markers : TPtr; IndexNo : LongInt):comp;
{
Var FindComp : comp;

GetMarkerMy := 0;
if (GetMarker(Markers, IndexNo, FindComp)=True) then GetMarkerMy := FindComp;
} // function GetMarkerMy


function MSGForm(mTable : string[15]; mRec : comp; mPrOper : word):word;
{
Var
  sMessage : string;

  if (_nMsgFrm=0)
    ErrObMol.PutEventById (feDoLoop, fcCycleOfResMol);
  if (_nMsgFrm = ErrorJoi)
    {
    ErrObMol.write('"'+sObName+'"');
    ErrObMol.write(JoiHead.cRec);
    ErrObMol.PutEventById (feDoLoop, fcCycleOfObMol);
    }
  if (_nMsgFrm=ErrorSp)
    {
    if (prSp=True)
      {
      ErrObMol.write('"'+sOb1Name+'"');
      ErrObMol.write(SpJoi.cRec);
      }
    else
      {
      ErrObMol.write('"'+sObName+'"');
      ErrObMol.write(JoiHead.cRec);
      }
    ErrObMol.PutEventById (feDoLoop, fcCycleOfErrorMol);
    }

  _nMsgFrm:=_nMsgFrm+1;
  case mPrOper of
    Word(1) : sMessage:='Не удалось модифицировать запись';
    Word(2) : sMessage:='Не удалось удалить запись';
    Word(3) : sMessage:='Не удалось вставить запись';
  end; // case

  ErrObMol.write(_nMsgFrm);
  ErrObMol.write(mTable);
  ErrObMol.write(mRec);
  ErrObMol.write(sMessage);

  MSGForm:=cmYes;
};

function MSGFormDop(mTable : string[15]; mRec : comp; mPrOper : word; DopMessage : string):word;
{
Var
  sMessage : string;

  if (_nMsgFrm=0)
    ErrObMol.PutEventById (feDoLoop, fcCycleOfResMol);
  if (_nMsgFrm = ErrorJoi)
    {
    ErrObMol.write('"'+sObName+'"');
    ErrObMol.write(JoiHead.cRec);
    ErrObMol.PutEventById (feDoLoop, fcCycleOfObMol);
    }
  if (_nMsgFrm=ErrorSp)
    {
    if (prSp=True)
      {
      ErrObMol.write('"'+sOb1Name+'"');
      ErrObMol.write(SpJoi.cRec);
      }
    else
      {
      ErrObMol.write('"'+sObName+'"');
      ErrObMol.write(JoiHead.cRec);
      }
    ErrObMol.PutEventById (feDoLoop, fcCycleOfErrorMol);
    }

  _nMsgFrm:=_nMsgFrm+1;
  case mPrOper of
    Word(1) : sMessage:='Не удалось модифицировать запись';
    Word(2) : sMessage:='Не удалось удалить запись';
    Word(3) : sMessage:='Не удалось вставить запись';
  end; // case

  ErrObMol.write(_nMsgFrm);
  ErrObMol.write(mTable);
  ErrObMol.write(mRec);
  ErrObMol.write(sMessage+DopMessage);

  MSGFormDop:=cmYes;
};
